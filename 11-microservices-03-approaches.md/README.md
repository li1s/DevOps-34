# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

### Решение

Для обеспечения процесса разработки, включая хранение исходного кода, непрерывную интеграцию и непрерывную поставку, можно использовать следующее решение:

`GitHub`, `GitLab`, `GitFlick` используются для хранения исходного кода. Оба инструмента поддерживают систему контроля версий Git и позволяют создавать отдельный репозиторий для каждого сервиса. Они также предоставляют возможность запускать сборку по событию из системы контроля версий (например, при коммите в определенную ветку).

`Jenkins` - это инструмент для непрерывной интеграции и непрерывной поставки. Он позволяет запускать сборку по кнопке с указанием параметров, привязывать настройки к каждой сборке и создавать шаблоны для различных конфигураций сборок. `Jenkins` также поддерживает безопасное хранение секретных данных (пароли, ключи доступа) и позволяет создавать несколько конфигураций для сборки из одного репозитория. Кроме того, с `Jenkins` можно определить кастомные шаги при сборке и использовать собственные докер-образы для сборки проектов. `Jenkins` также поддерживает возможность развернуть агентов сборки на собственных серверах, параллельный запуск нескольких сборок и параллельный запуск тестов.

`Docker` используется для создания и управления контейнерами, в которых запускаются ваши приложения. `Docker` позволяет создавать собственные образы, которые затем можно использовать в `Jenkins` для сборки проектов.

Дополнить список можно еще и такими инструментами как: `Bamboo`, `TeamCity`.
P.S. естественно для хранения всех секретов лучше использовать специализированные решение, такие как `Hashicorp vault`

---

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

### Решение

Под указанные требования подходит золотой стандарт мониторинга - стэк `ELK`. Известное решение, по нему много информации и все с ним работали. `Elasticsearch Logstash Kibana`

Состоит из:

- `FileBeat` - агент, собирающий данные с машины и направляющий в Elasticsearch.
- `Logstash` - служба обрабатывающая данные: фильтрует, парсит на составляющие поля, агрегирует строки, обогащает данные при необходимости и т.п. передает данные в системы потребители при необходимости.
- `Elasticsearch` - инструмент аналитики и полнотекстового поиска, позволяет хранить, оперативно получать нужные данные больших объемов.
- `Kibana` - Web визуальный инструмент для Elasticsearch, позволяет управлять индексами Elasticsearch, выполнять непосредственный визуальный поиск, строить Dashbord-ы для удобства оперативного анализа логов (данных).

Аналог: ELV (LightHouse / Vector).

---

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

### Решение

Для мониторинга, на мой взгляд, лучшим решением будет стек `prometheus` + `grafana` + `node exporter`. Комплекс соответствует всем вышеуказанным требованиям.

- `Prometheus`- это система мониторинга и алертинга, которая собирает и хранит временные ряды метрик. Она позволяет собирать метрики от различных источников, включая `Node Exporter`, и предоставляет гибкий язык запросов для анализа и визуализации данных. `Prometheus` поддерживает облачные системы и может быть развернут в облаке.

- `Grafana` - это платформа для визуализации данных и построения дашбордов. Она интегрируется с `Prometheus` и позволяет создавать красивые и информативные графики, диаграммы и панели управления. `Grafana` поддерживает облачные системы и может быть развернута в облаке.

- `Node Exporter` - это экспортер `Prometheus`, который собирает системные метрики с узлов (например, CPU, память, диски, сеть) и предоставляет их в формате, понятном для `Prometheus`. `Node Exporter` может быть установлен на каждом узле, который вы хотите мониторить.

Взаимодействие между этими компонентами выглядит следующим образом:

- `Node Exporter` собирает системные метрики с узлов и предоставляет их в формате, понятном для `Prometheus`.
- `Prometheus` собирает метрики от `Node Exporter` и других источников, хранит их во временных рядах и предоставляет возможность выполнения запросов к данным.
- `Grafana` подключается к `Prometheus` в качестве источника данных и использует его метрики для создания графиков, диаграмм и панелей управления.
